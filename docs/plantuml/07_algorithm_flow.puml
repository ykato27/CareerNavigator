@startuml アルゴリズムフロー図
!theme plain
skinparam backgroundColor #FFFFFF
skinparam activityBackgroundColor #E8F4F8
skinparam activityBorderColor #333333
skinparam arrowColor #4A90E2
skinparam defaultFontName "Noto Sans CJK JP, IPAGothic, MS Gothic, sans-serif"

title CareerNavigator 因果推論推薦アルゴリズムフロー v3.0.0

|#E8F5E9|データ準備フェーズ|
start
:スキル・資格・教育データの読み込み;
:欠損値処理・正規化;
:バイナリデータ変換 (保有/未保有);

|#E3F2FD|因果グラフ構築フェーズ (LiNGAM)|
:DirectLiNGAM アルゴリズム適用;
note right
  変数間の因果的順序を特定
  x_i = Σ b_ij * x_j + e_i
end note

:因果グラフ (DAG) 生成;
:隣接行列 (Adjacency Matrix) 取得;
:サイクル除去 (DAG制約の保証);
:ブートストラップ法による信頼性評価;

|#FFF3E0|3軸スコアリングフェーズ|
fork
  |#FFE0B2|準備完了度 (Readiness)|
  :前提スキルの習得状況を確認;
  :親ノードの充足率を計算;
  :Readiness Score (0.0-1.0) 算出;
fork again
  |#FFCCBC|確率スコア (Probability)|
  :条件付き確率 P(Target | Parents) 計算;
  :ロジスティック回帰 / ベイズ推定;
  :Probability Score (0.0-1.0) 算出;
fork again
  |#D1C4E9|有用性スコア (Utility)|
  :キャリア目標との関連性;
  :市場価値 / 希少性;
  :Utility Score (0.0-1.0) 算出;
end fork

|#FFF9C4|統合・フィルタリングフェーズ|
:総合スコア計算;
note right
  Score = w1*Readiness + w2*Probability + w3*Utility
end note

:Causalフィルタリング;
note right
  ・因果的に不可能なパスを除外
  ・前提条件未達のスキルを除外
end note

:スマートロードマップ生成;
:依存関係に基づく順序付け;

|#BBDEFB|最終出力|
:推薦リスト生成;
:因果グラフ可視化 (Pyvis);
:推薦理由の生成 (因果パスに基づく説明);

stop

legend right
  |色|フェーズ|
  |<#E8F5E9>|データ準備|
  |<#E3F2FD>|因果グラフ構築 (LiNGAM)|
  |<#FFF3E0>|3軸スコアリング|
  |<#FFF9C4>|統合・フィルタリング|
  |<#BBDEFB>|出力・可視化|
endlegend

@enduml
