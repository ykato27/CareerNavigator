# Streamlitアプリケーション - 完全ガイド

CareerNavigatorのStreamlitアプリケーションは、ブラウザベース対話的なWebインターフェースで、スキル推薦とキャリア分析を提供します。

## 起動方法

```bash
# プロジェクトディレクトリに移動
cd CareerNavigator

# Streamlitアプリを起動
uv run streamlit run streamlit_app.py
```

ブラウザが自動的に開き、`http://localhost:8501` でアプリケーションにアクセスできます。

## アプリケーション構成

Streamlitアプリは4つのページで構成されています：

### 📁 データ読み込み（メインページ）

**ファイル**: `streamlit_app.py`

#### 機能

1. **CSVアップロード**
   - ドラッグ&ドロップ対応
   - 複数ファイルの一括アップロード
   - 対応ファイル種別:
     - メンバーデータ (`members/`)
     - 習得力量データ (`acquired/`)
     - スキル力量データ (`skills/`)
     - 教育力量データ (`education/`)
     - 資格力量データ (`license/`)
     - カテゴリデータ (`categories/`)

2. **データ変換**
   - 自動データクレンジング
   - 列名の正規化
   - データ型変換

3. **データ品質チェック**
   - 欠損値の検出
   - 重複データの確認
   - データ整合性の検証

4. **データ永続化**
   - セッションステートへの保存
   - 知識グラフの自動構築

#### 使い方

1. サイドバーから各データファイルをアップロード
2. 「データ変換を実行」ボタンをクリック
3. 変換結果を確認
4. 他のページに移動して分析開始

---

###  🧠 因果推論ベース推薦

**ファイル**: `pages/1_Causal_Recommendation.py`

#### 機能

1. **因果グラフ構築**
   - LiNGAMアルゴリズムによる因果構造学習
   - スキル間の依存関係の抽出
   - 因果効果の定量化

2. **3軸スコアリング**
   - **準備完了度 (Readiness Score)**: 現在保有スキルからの習得しやすさ
   - **確率スコア (Probability Score)**: ベイジアンネットワークによる習得確率
   - **有用性スコア (Utility Score)**: 将来のスキル習得への貢献度

3. **推薦スキル表示**
   - 総合スコア順にランキング
   - 各スコアの詳細表示
   - 推薦理由の説明

4. **インタラクティブ因果グラフ**
   - Pyvisによる3D可視化
   - ノードクリックで詳細表示
   - ズーム・パン操作対応

#### 使い方

1. **メンバー選択**
   - 分析対象のメンバーをドロップダウンから選択

2. **閾値調整**
   - 総合スコアの最小値
   - 準備完了度閾値
   - 依存関係の閾値

3. **推薦結果の確認**
   - 推薦スキルリストを確認
   - 各スキルの詳細スコア確認
   - 推薦理由の確認

4. **因果グラフの操作**
   - 特定スキルを中心としたグラフ表示
   - エッジの因果効果を確認
   - インタラクティブに探索

#### 調整可能なパラメータ

- **総合スコアの最小値**: 0.0 ~ 1.0（デフォルト: 0.02）
- **準備完了度閾値**: 0.0 ~ 1.0（デフォルト: 0.0）
- **依存関係の閾値**: 0.0 ~ 0.5（デフォルト: 0.03）
- **グラフ表示閾値**: 0.01 ~ 1.0（デフォルト: 0.05）

---

### 🎯 従業員向けキャリアダッシュボード

**ファイル**: `pages/2_Employee_Career_Dashboard.py`

#### 機能

1. **目標設定**
   - **ロールモデルから選ぶ**: 特定のメンバーを目標に設定
   - **職種・役職から選ぶ**: 役職全体のスキル保有率ベースで目標設定
     - 最小スキル保有率の調整（0-100%）
     - 優先度分類閾値の設定（必須・推奨・オプショナル）

2. **ギャップ分析**
   - 現在の保有スキルと目標とのギャップを可視化
   - 不足スキルの抽出
   - スキルカテゴリ別の分析

3. **Causal統合推薦**
   - 因果推論ベースのスキルフィルタリング
   - 依存関係を考慮した優先順位付け
   - 学習の準備状況に応じた推薦

4. **スマートキャリアロードマップ**
   - ガントチャート形式の学習計画
   - 依存関係を考慮した直列・並列配置
   - 推定学習期間の表示

5. **キャリアパス比較**
   - 複数の目標を並列で比較
   - タブ形式で切り替え可能

#### 使い方

1. **分析対象メンバーの選択**
   - 自分（または分析したいメンバー）を選択

2. **キャリア目標の設定**
   - **ロールモデルアプローチ**: 
     - 目指す先輩社員を選択
     - 通常モードまたは比較モード（2つの目標）
   
   - **役職ベースアプローチ**:
     - 目標役職を選択
     - 最小スキル保有率を設定（例: 30%）
     - 優先度閾値を調整（必須スキル: 50%、推奨スキル: 30%）

3. **Causal推薦設定の調整**
   - サイドバーで各種閾値を調整
   - 総合スコア、準備完了度、依存関係の最小値

4. **ロードマップの確認**
   - 推薦スキルの学習順序を確認
   - 依存関係を考慮した最適な学習経路
   - 推定学習期間の確認

5. **推薦スキル詳細の確認**
   - スキル詳細リスト（Causalスコア順）
   - 推薦理由の詳細
   - 前提スキルと次のステップ

6. **因果グラフの確認**
   - 推薦スキルを中心とした関連グラフ
   - スキルごとの因果関係の可視化

#### 表示モード

- **通常モード**: 1つの目標に集中
- **キャリア比較モード**: 2つの目標を並列で比較

---

### 🗺️ 組織スキルマップ

**ファイル**: `pages/3_Organizational_Skill_Map.py`

#### 機能

1. **組織スキル分布の可視化**
   - 組織全体のスキル保有状況
   - カテゴリ別スキル分布
   - スキルタイプ別分析（SKILL / EDUCATION / LICENSE）

2. **スキルギャップ分析**
   - 組織として不足しているスキルの特定
   - 重要度の高いスキルの欠員状況
   - スキルカバレッジの可視化

3. **後継者計画（Succession Planning）**
   - 重要ポジションの後継候補者分析
   - スキル適合度スコアリング
   - 育成が必要なスキルの特定

4. **スキル保有者マトリクス**
   - メンバー × スキルのヒートマップ
   - 特定スキルの保有者一覧
   - スキルレベルの可視化

#### 使い方

1. **分析視点の選択**
   - 組織全体分析
   - 部門別分析
   - 役職別分析

2. **スキルフィルタリング**
   - スキルタイプでフィルタ（SKILL / EDUCATION / LICENSE）
   - カテゴリでフィルタ
   - 保有者数でフィルタ

3. **可視化の確認**
   - インタラクティブなグラフとチャート
   - ドリルダウン分析
   - データのエクスポート

4. **後継者計画の実行**
   - キーポジションの選択
   - 後継候補者のランキング
   - 育成計画の策定

---

## 共通機能

### サイドバー

すべてのページで以下の機能が利用可能：

-  **データ読み込み状況の確認**
  - 読み込み済みデータの統計情報
  - メンバー数、力量数、習得記録数

- **設定調整**
  - 各種パラメータの動的調整
  - リアルタイムでの結果更新

### データエクスポート

- **CSVダウンロード**: 推薦結果や分析結果をCSV形式でダウンロード
- **グラフ保存**: 可視化グラフを画像として保存

---

## トラブルシューティング

### データが読み込まれない

**症状**: 「データが読み込まれていません」というエラーメッセージ

**対処法**:
1. メインページ（データ読み込み）に戻る
2. 必要なCSVファイルをアップロード
3. 「データ変換を実行」ボタンをクリック

### 推薦結果が空

**症状**: 推薦スキルが表示されない

**対処法**:
1. 閾値を下げる（総合スコアの最小値を0.01など）
2. 他のメンバーで試す
3. データの整合性を確認

### 因果グラフが表示されない

**症状**: グラフエリアが空白

**対処法**:
1. グラフ表示閾値を下げる
2. 別のスキルを選択
3. ブラウザのキャッシュをクリア

---

## パフォーマンス最適化

### 推奨環境

- **ブラウザ**: Chrome, Firefox, Edge（最新版）
- **メモリ**: 8GB以上推奨
- **CPU**: マルチコア推奨

### 高速化のヒント

1. **データサイズの最適化**
   - 不要なメンバーデータを除外
   - 分析期間を限定

2. **キャッシュの活用**
   - セッションステートのデータを再利用
   - モデルの再計算を最小化

3. **並列処理**
   - 複数タブを開かない
   - 1つの分析が完了してから次へ

---

## 関連ドキュメント

- [因果推論推薦の詳細](CAUSAL_RECOMMENDATION.md)
- [WebUIガイド](WEBUI_GUIDE.md)
- [機械学習モデル参考資料](ML_MODELS_REFERENCE.md)
- [アーキテクチャドキュメント](ARCHITECTURE.md)

---

## 開発者向け情報

### ページ構造

各Streamlitページは以下の構造を持ちます：

```python
# 1. ページ設定
st.set_page_config(
    page_title="ページタイトル",
    page_icon="📊",
    layout="wide"
)

# 2. スタイル適用
apply_enterprise_styles()

# 3. データ読み込みチェック
if "transformed_data" not in st.session_state:
    st.warning("データを読み込んでください")
    st.stop()

# 4. メイン処理
# - ユーザー入力の受付
# - データ処理
# - 結果の表示
```

### スタイルカスタマイズ

`skillnote_recommendation/streamlit_ui/styles.py` でUI スタイルをカスタマイズ可能：

- カラーテーマ
- フォントサイズ
- レイアウト設定

### 新しいページの追加

1. `pages/` ディレクトリに新しいPythonファイルを作成
2. ファイル名は `数字_ページ名.py` の形式
3. 上記のページ構造に従って実装
4. `st.session_state` でデータ共有
