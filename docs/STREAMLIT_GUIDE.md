# Streamlitアプリケーションガイド

## 概要

スキルノート推薦システムのStreamlitアプリケーションは、ブラウザベースのインタラクティブなWebアプリケーションです。

> **関連ドキュメント**: モデルの詳細については、[MODELS_TECHNICAL_GUIDE.md](MODELS_TECHNICAL_GUIDE.md)および[ML_TECHNICAL_DETAILS.md](ML_TECHNICAL_DETAILS.md)を参照してください。

**主な機能:**
- ✅ 全6種類のCSVファイルアップロード
- ✅ 既存メンバーへの推薦
- ✅ 新規ユーザーへの推薦（CSVアップロード）
- ✅ 機械学習ベースの推薦システム
- ✅ ロールモデル（参考となるメンバー）の表示
- ✅ 多様性メトリクスの可視化
- ✅ 推薦結果のCSVダウンロード

## 起動方法

### 1. 依存関係のインストール

```bash
cd CareerNavigator
uv sync
```

### 2. Streamlitアプリの起動

```bash
uv run streamlit run streamlit_app.py
```

ブラウザが自動的に開き、`http://localhost:8501` でアプリケーションが表示されます。

### 3. ポート変更（オプション）

```bash
uv run streamlit run streamlit_app.py --server.port 8502
```

## 使い方

### ステップ1: データアップロード

左のサイドバーから、全6種類のCSVファイルをアップロードします：

1. **メンバーデータ** (members.csv)
2. **習得力量データ** (acquired.csv)
3. **スキル力量マスター** (skills.csv)
4. **教育力量マスター** (education.csv)
5. **資格力量マスター** (license.csv)
6. **カテゴリマスター** (categories.csv)

全てアップロード後、**「データ読み込み」** ボタンをクリックします。

### ステップ2: MLモデル学習（オプション）

ML推薦を使用する場合は、サイドバーの **「MLモデル学習」** ボタンをクリックしてください。

- 学習には数秒〜数十秒かかります
- 学習完了後、ML推薦が利用可能になります

### ステップ3: 推薦実行

#### A. 既存メンバーへの推薦

1. **「既存メンバーの推薦」** タブを選択
2. 推薦対象のメンバーをセレクトボックスから選択
3. 推薦設定を調整:
   - 推薦件数（5〜50件）
   - 力量タイプフィルタ（全て / SKILL / EDUCATION / LICENSE）
   - 多様性戦略（hybrid / mmr / category / type）
4. **「推薦実行」** ボタンをクリック

#### B. 新規ユーザーへの推薦

1. **「新規ユーザーの推薦」** タブを選択
2. [新規ユーザーCSVテンプレート](../templates/new_user_template.csv)をダウンロード
3. テンプレートを編集して保存:
   ```csv
   メンバーコード,メンバー名,力量コード,力量レベル
   m999,新規ユーザー,s001,3
   m999,新規ユーザー,s002,5
   m999,新規ユーザー,e001,1
   ```
4. 編集したCSVファイルをアップロード
5. 推薦設定を調整
6. **「推薦実行」** ボタンをクリック

## 推薦結果の見方

### 推薦結果表示

機械学習ベースの推薦結果が表示されます。

各推薦結果には以下の情報が表示されます：

```
1. 力量名 (スコア: X.XX)
  力量コード: sXXX
  タイプ: SKILL
  カテゴリ: XX > XX
  推薦理由: XXX

  👥 参考となるメンバー（この力量を習得済み）:
  - 山田太郎 (Lv.5) - 総習得力量: 120件
  - 佐藤花子 (Lv.4) - 総習得力量: 98件
```

### ロールモデル（参考となるメンバー）

各推薦力量について、それを既に習得しているメンバーが表示されます：

- **メンバー名**: ロールモデルとなるメンバー
- **レベル**: その力量の習得レベル
- **総習得力量**: そのメンバーが持つ全力量数

**活用方法:**
- 同じ力量を持つ先輩社員に相談できる
- 習得のための具体的なアドバイスをもらえる
- キャリアパスの参考になる

### 多様性メトリクス（ML推薦のみ）

ML推薦実行後、以下のメトリクスが表示されます：

| メトリクス | 説明 | 範囲 | 良い値 |
|-----------|------|------|--------|
| カテゴリ多様性 | 異なるカテゴリからの推薦割合 | 0.0〜1.0 | 高い方が良い |
| タイプ多様性 | SKILL/EDUCATION/LICENSEのバランス | 0.0〜1.0 | 高い方が良い |
| カバレッジ | 推薦に含まれる異なるカテゴリの割合 | 0.0〜1.0 | 高い方が良い |
| リスト内多様性 | 推薦リスト内の力量の多様性 | 0.0〜1.0 | 高い方が良い |

### グラフ表示

ML推薦後、2つのグラフが表示されます：

1. **カテゴリ分布（棒グラフ）**: どのカテゴリから何件推薦されたか
2. **タイプ分布（円グラフ）**: SKILL/EDUCATION/LICENSEの比率

## CSVダウンロード

推薦結果は CSV ファイルとしてダウンロードできます：

- **推薦結果をダウンロード** ボタン

ダウンロードされるCSVには以下が含まれます：

| カラム | 説明 |
|--------|------|
| 順位 | 推薦順位 |
| 力量コード | 力量の識別コード |
| 力量名 | 力量の名称 |
| タイプ | SKILL/EDUCATION/LICENSE |
| カテゴリ | 力量のカテゴリ |
| スコア | 推薦スコア |
| 推薦理由 | 推薦された理由 |

## 多様性戦略の選択

ML推薦では、4つの多様性戦略から選択できます：

### 1. hybrid（ハイブリッド）**デフォルト推奨**

- MMR、カテゴリ多様性、タイプ多様性を組み合わせ
- 最もバランスが良い
- 推奨: 初回利用時やバランス重視の場合

### 2. mmr (Maximal Marginal Relevance)

- 関連度と多様性のバランスを取る
- λパラメータで調整（デフォルト=0.7）
- 推奨: 関連度を重視しつつ多様性も欲しい場合

### 3. category（カテゴリ多様性）

- 異なるカテゴリから均等に推薦
- カテゴリごとの上限を設定可能
- 推奨: 幅広い分野の力量を習得したい場合

### 4. type（タイプ多様性）

- SKILL/EDUCATION/LICENSEをバランス良く推薦
- タイプ比率の指定可能
- 推奨: 特定のタイプに偏らない推薦が欲しい場合

## トラブルシューティング

### Q1: アプリが起動しない

```bash
# 依存関係を再インストール
uv sync

# ポートを変更して起動
uv run streamlit run streamlit_app.py --server.port 8502
```

### Q2: CSVアップロードエラー

- **エンコーディング**: UTF-8で保存されているか確認
- **カラム名**: 正しいカラム名が使われているか確認
- **ファイルサイズ**: 大きすぎるファイルは分割してアップロード

### Q3: ML推薦が表示されない

1. サイドバーで「MLモデル学習」を実行したか確認
2. 学習完了メッセージが表示されたか確認
3. エラーメッセージが表示されていないか確認

### Q4: 新規ユーザーCSVのエラー

**正しいフォーマット:**
```csv
メンバーコード,メンバー名,力量コード,力量レベル
m999,新規ユーザー,s001,3
```

**よくある間違い:**
- ❌ カラム名が違う
- ❌ 力量コードが力量マスターに存在しない
- ❌ レベルが1-5の範囲外

### Q5: ロールモデルが表示されない

その力量を習得しているメンバーがいない可能性があります。これは正常な動作です。

## パフォーマンスTips

### データサイズが大きい場合

- メンバー数が1000人以上の場合、ML学習に時間がかかります
- 初回のみ学習し、セッション中は再学習不要です

### ブラウザキャッシュ

Streamlitはセッションごとにデータを保持します：
- ページをリロードするとデータが消えます
- 同じデータを使う場合は、リロードせずに使い続けてください

## セキュリティ

### ローカル実行推奨

- **本番環境での公開は推奨しません**
- 機密データを含むため、ローカル実行のみを想定
- 公開する場合は、認証機能の追加を検討してください

### データの扱い

- アップロードされたCSVは一時ディレクトリに保存されます
- ブラウザを閉じると、セッションデータは削除されます
- ダウンロードしたCSVは適切に管理してください

## 開発者向け情報

### アプリ構成

```
streamlit_app.py
├── データアップロード（サイドバー）
├── タブ1: 既存メンバーの推薦
│   ├── メンバー選択
│   ├── 推薦設定
│   ├── 推薦実行
│   ├── 結果表示（2カラム）
│   ├── 多様性メトリクス
│   └── CSVダウンロード
└── タブ2: 新規ユーザーの推薦
    ├── CSVアップロード
    ├── ユーザー情報表示
    ├── 推薦設定
    ├── 推薦実行
    ├── 結果表示（2カラム）
    ├── 多様性メトリクス
    └── CSVダウンロード
```

### セッション状態

Streamlitは以下の状態を管理しています：

| 状態変数 | 内容 |
|---------|------|
| data_loaded | データ読み込み済みフラグ |
| raw_data | 生データ |
| transformed_data | 変換済みデータ |
| ml_recommender | ML推薦システム |
| role_model_finder | ロールモデル検索 |
| temp_dir | 一時ディレクトリパス |

### カスタマイズ

`streamlit_app.py` を編集して、以下をカスタマイズできます：

- UIレイアウト
- デフォルト値（推薦件数、多様性戦略など）
- 表示項目
- グラフのスタイル

## 関連ドキュメント

- [MODELS_TECHNICAL_GUIDE.md](MODELS_TECHNICAL_GUIDE.md) - モデル実装の詳細、データ前処理、ハイパーパラメータチューニング
- [ML_TECHNICAL_DETAILS.md](ML_TECHNICAL_DETAILS.md) - 機械学習推薦システムの技術詳細
- [EVALUATION.md](EVALUATION.md) - 推薦システムの評価方法
- [CODE_STRUCTURE.md](CODE_STRUCTURE.md) - コード構造とモジュール設計（238テスト、カバレッジ30%）
- [QUICKSTART.md](QUICKSTART.md) - クイックスタートガイド
- [本プロジェクトREADME](../README.md) - プロジェクト全体の概要

## 参考リンク

- [Streamlit公式ドキュメント](https://docs.streamlit.io/)
- [Plotly公式ドキュメント](https://plotly.com/python/)
- [新規ユーザーCSVテンプレート](../templates/new_user_template.csv)
- [テンプレート使い方ガイド](../templates/README.md)
